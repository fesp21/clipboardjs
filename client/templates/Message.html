<template name="message_view">
    {{#if is_message_opened}}
    
    {{#with message}}
    {{#if this}}
    <div class="clearfix view-toolbar">
        <div class="btn-toolbar pull-left">
            <p class="message-actions btn-group">
                <button class="btn btn-small collapsing-btn" title="comments" data-placement="bottom" disabled><i class="icon-comment"></i> {{message_comment_count short_id}}</button>
                <button class="raw btn btn-small collapsing-btn" title="show raw message" data-placement="bottom" data-original-title="show raw message"><i class="icon-file"></i></button>
                <button class="share btn btn-small collapsing-btn" title="share message" data-placement="bottom" data-original-title="share message"><i class="icon-share"></i></button>
            </p>
            <p class="message-actions btn-group">
                <button class="edit btn btn-small collapsing-btn" title="edit message" data-placement="bottom" data-original-title="edit message"><i class="icon-wrench"></i></button>
            </p>
        </div>
        
        <div class="message-editor btn-toolbar pull-left">
            {{#if show_editor}}
            {{#if is_owner user_id}}
            <p class="btn-group pull-left" title="Change paste language" data-placement="bottom">{{> language_btn_group}}</p>
            {{/if}}
            <p class="btn-group pull-left" title="1. Select text below <br>2. add the annotation" data-placement="bottom">
                <button class="add-annotation btn btn-small"><i class="icon-comment"></i><sup><strong>+</strong></sup></button>
            </p>
            {{else}}
                <p class="btn-group pull-left">
                    <button class="btn btn-small btn-warning login-proxy"><i class="icon-exclamation-sign icon-white"></i>&nbsp;Login to add comments</button>
                </p>
            {{/if}}
        </div>
    </div>

    <div class="message-view">
        <p class="message-detail">
            <span class="lang">{{language}}</span></span>
        </p>
        <p class="author-detail">
            <span class="lang">{{user_name}}</span>
        </p>
        <pre class="prettyprint"><code class="code-annotated">{{{annotated this}}}</code><code class="code-view {{language}}">{{{highlighted}}}</code><code class="code-raw">{{{raw this}}}</code></pre>
    </div>
    {{/if}}
    {{/with}}
    
    {{/if}}
</template>
<template name="message_detail_unavailable">
    <div class="alert alert-block">
        <h4>:(</h4>

        <p>The message you requested is unavailable</p>
    </div>
</template>
<template name="comment_popover">
    {{#each this}}
    <span class="label label-info">{{author}}</span> {{comment}}  <br>
    {{/each}}
</template>
<template name="message_annotations_none">
</template>
<template name="message_raw">
    <div class="raw-file">
        <button class="close">&times;</button>
        <textarea>{{raw}}</textarea>
    </div>
</template>